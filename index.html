<!DOCTYPE html>
<html lang="en">
<head>
  <style>
  body {
    background: #f7f7f7;
    margin: 0;
    padding: 10px;
    font-family: "Noto Sans", sans-serif;
  }
  #forum-box {
    max-width: 650px;
    margin: 20px auto;
    background: #fff;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  }
  h1 {
    font-size: 1.4em;
    text-align: center;
  }
</style>

<meta charset="UTF-8">
<meta name="description" content="Forum komuniti skateboard Malaysia. Sertai perbincangan dalam Bahasa Melayu, English, dan ä¸­æ–‡.">
<meta name="keywords" content="skateboard, forum, malaysia, ä¸­æ–‡, bahasa melayu, english">
<meta name="author" content="Skateboard.my">
<title>Skateboard Forum</title>
</head>
<body>
  <div id="forum-box">
  <h1 id="pageTitle">ğŸ’¬ Forum</h1>
  <!--
  <div>
    <button onclick="switchLang('en')">English</button>
    <button onclick="switchLang('ms')">Bahasa Melayu</button>
    <button onclick="switchLang('zh_CN')">ä¸­æ–‡</button>
  </div>
  -->
  <div id="disqus_thread"></div>
  </div>
  <script>
  // è‡ªå‹•èªè¨€åµæ¸¬ + æœ¬åœ°è¨­å®š
  let userLang = localStorage.getItem('lang') || 
                 (navigator.language.startsWith('zh') ? 'zh_CN' :
                  navigator.language.startsWith('ms') ? 'ms' : 'en');

  // æ ¹æ“šèªè¨€æ”¹é é¢æ¨™é¡Œ
  const titles = { en: "ğŸ’¬ Skateboard.my Forum", ms: "ğŸ’¬ Forum Skateboard.my", zh_CN: "ğŸ’¬ Skateboard.my æ»‘æ¿è®ºå›" };
  document.getElementById('pageTitle').innerText = titles[userLang] || titles['en'];

  // å»ºç«‹ disqus_config
  var disqus_config = function () {
    this.page.url = window.location.href;
    //this.page.identifier = window.location.pathname;

    // æ ¹æ“š URL åˆ¤æ–·æ˜¯å¦æœ‰æŒ‡å®šç‰ˆï¼ˆä¾‹å¦‚ /forum/tech æˆ– /topic/streetï¼‰
    var path = window.location.pathname;

    // è‹¥ path å¤ªçŸ­ï¼ˆä¾‹å¦‚åªæ˜¯ "/" æˆ– "/forum"ï¼‰ï¼Œä½¿ç”¨ä¸»ç‰ˆ "sk-main"
    if (path === "/" || path === "/forum" || path === "/forum/") {
      this.page.identifier = "sk-main";
    } else {
      // å¦å‰‡ç”¨ç›®å‰è·¯å¾‘ä½œç‚ºç‰ˆçš„è­˜åˆ¥ç¢¼
      this.page.identifier = path.replace(/\//g, "-").replace(/^-|-$/g, "");
    }

    this.language = userLang;
  };

  // è¼‰å…¥ Disqus
  (function() {
    var d = document, s = d.createElement('script');
    s.src = 'https://skateboard-my.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();

  // åˆ‡æ›èªè¨€
  function switchLang(lang) {
    localStorage.setItem('lang', lang);
    location.reload();
  }
  

    
  </script>
</body>
</html>

<!-- ===== iframe å…§é  (GitHub Pages) ===== -->
<script>
(function() {
  // èŠ‚æµï¼šæœ€å¤šæ¯ 200ms å‘é€ä¸€æ¬¡é«˜åº¦
  let lastSent = 0;
  let lastHeight = 0;
  function sendHeightIfChanged(force = false) {
    const h = Math.max(
      document.documentElement.scrollHeight,
      document.body.scrollHeight,
      document.documentElement.offsetHeight,
      document.body.offsetHeight
    );
    const now = Date.now();
    if (!force && Math.abs(h - lastHeight) < 6 && (now - lastSent) < 200) {
      return; // æ— æ˜¾è‘—å˜åŒ–æˆ–å‘é€å¤ªé¢‘ç¹
    }
    lastHeight = h;
    lastSent = now;
    // å‘é€ç»™çˆ¶é ï¼ˆè‹¥é™åˆ¶ originï¼Œæ”¹è¿™é‡Œï¼‰
    window.parent.postMessage({ type: 'resizeForum', height: h }, '*');
    // console.log('iframe: å‘é€é«˜åº¦', h);
  }

  // 1) åœ¨ load æ—¶å‘ä¸€è½®ï¼ˆç¡®ä¿åŸºæœ¬ DOM å·²æ¸²æŸ“ï¼‰
  window.addEventListener('load', function() {
    // å¤šæ¬¡å‘é€ä»¥è¦†ç›–åŠ¨æ€åŠ è½½çš„ç¬¬ä¸‰æ–¹ï¼ˆDisqusï¼‰
    sendHeightIfChanged(true);
    // è®©æµè§ˆå™¨å®Œæˆé‡ç»˜åå†ç®—ä¸€æ¬¡
    requestAnimationFrame(()=> setTimeout(()=>sendHeightIfChanged(true), 50));
    setTimeout(()=>sendHeightIfChanged(true), 600);
    setTimeout(()=>sendHeightIfChanged(true), 1200);
  });

  // 2) è§‚å¯Ÿ DOM å˜åŒ–ï¼ˆMutationObserverï¼‰
  const observer = new MutationObserver(function(mutations) {
    // å»¶è¿Ÿè§¦å‘ï¼Œé¿å…çŸ­æ—¶é—´å¤§é‡ postMessage
    clearTimeout(window.__resizeTO);
    window.__resizeTO = setTimeout(()=>sendHeightIfChanged(false), 120);
  });
  observer.observe(document.documentElement || document.body, { childList: true, subtree: true, attributes: true });

  // 3) ç›‘å¬å›¾ç‰‡ã€iframe ç­‰ media çš„ load äº‹ä»¶ï¼ˆç¡®ä¿å›¾ç‰‡åŠ è½½åå†æµ‹ï¼‰
  function attachMediaListeners() {
    const imgs = Array.from(document.images || []);
    imgs.forEach(img => {
      if (!img.__hasListener) {
        img.addEventListener('load', ()=> sendHeightIfChanged(true));
        img.addEventListener('error', ()=> sendHeightIfChanged(true));
        img.__hasListener = true;
      }
    });
    // é¢å¤–ï¼šè‹¥ä½ æœ‰å…¶ä»– iframe / embedsï¼Œä¹Ÿå¯ç±»ä¼¼æŒ‚è½½
    const frames = Array.from(document.querySelectorAll('iframe'));
    frames.forEach(f => {
      if (!f.__hasListener) {
        f.addEventListener('load', ()=> sendHeightIfChanged(true));
        f.__hasListener = true;
      }
    });
  }
  // åˆæ¬¡ & å®šæœŸæ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„å›¾ç‰‡è¢«æ’å…¥
  attachMediaListeners();
  setInterval(attachMediaListeners, 1500);

  // 4) Fallback pollï¼ˆè‹¥ MutationObserver å¤±æ•ˆï¼‰
  let lastPollH = 0;
  setInterval(function() {
    const h = Math.max(document.documentElement.scrollHeight, document.body.scrollHeight);
    if (Math.abs(h - lastPollH) > 6) {
      lastPollH = h;
      sendHeightIfChanged(true);
    }
  }, 800);

  // 5) æ¥æ”¶çˆ¶é çš„ requestHeight è¦æ±‚
  window.addEventListener('message', function(e) {
    const data = e.data || {};
    if (data && data.type === 'requestHeight') {
      sendHeightIfChanged(true);
    }
  }, false);

  // (debug) è‹¥éœ€åœ¨ iframe console çœ‹ logï¼Œè§£é™¤ä¸‹é¢è¨»è§£
  // setInterval(()=>console.log('iframe height', document.body.scrollHeight), 3000);
})();
</script>



